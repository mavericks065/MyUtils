#!/bin/bash

# Safety measures
set -o errexit   # Leave immediately if a command returns an error

FILES=$(find . -name node_modules)
TODAY=$(date +%Y-%m-%d)
echo "FILES ARE $FILES"
for file in $FILES
do 
    FILE_MOD_DATE=$(stat -f "%Sm" -t "%Y-%m-%d" $file)
    FILE_MOD_DATE_MINUS_15=$(date -j -v -15d -f "%Y-%m-%d" $FILE_MOD_DATE +%Y-%m-%d)

    if test $FILE_MOD_DATE_MINUS_15 -lt $TODAY ; then
        echo "rm -rf $file"
        rm -rf $file
    else 
        echo "NOT rm -rf $file"
    fi
done